abstract root command {
    class optional sym target;
    class_many optional sym components;
    class optional sym tool;
    class optional sym location;

    class optional sym invocation;
}

/* Info commands. */
command stats {}
command help {}

/* World-interaction commands. */

command inspect {}

command move {}

command attack {
    target corporeal;
    tool weapon;
}

command consume {
    target consumable;
}

command get {
    target item;
}

command stash {}

command drop {
    target item;
}

command equip {
}
command unequip {}

command hide {}

command unhide {}

/* PC-NPC Interactions. */

command say {}

/* Item construction. */

abstract command construct {
    invocation construct;
}

construct cook {}

construct forge {
    location anvil;
    tool hammer;
}

construct craft {}

construct make_bow {}

construct fletch {}

post_process {
    self.find_subtypes(:command, {}, true).each do |command|
        Log.debug("Propagating tool information for #{command}", 6)
        propagate_recursive(info_for(command, :tool)) do |subtype|
            Log.debug("#{subtype} is a required tool for #{command}", 6)
            name = :used_for
            modify_info(subtype, name, []) << command
        end

        Log.debug("Propagating target information for #{command}", 6)
        propagate_recursive(info_for(command, :target)) do |subtype|
            Log.debug("#{subtype} is a target of #{command}", 6)
            name = :target_of
            modify_info(subtype, name, []) << command
        end

        Log.debug("Propagating location information for #{command}", 6)
        propagate_recursive(info_for(command, :location)) do |subtype|
            Log.debug("#{subtype} is the location at which #{command} happens", 6)
            name = :location_of
            modify_info(subtype, name, []) << command
        end
    end
}
